# Worker Environment Variables for Distributed Trigger.dev Setup
# ==============================================================
# This file is for WORKER servers (supervisor + docker-proxy only)
# Get these values from your webapp deployment

# ============================================
# REQUIRED: Connection to Webapp
# ============================================

# Webapp URL (the URL where your Trigger.dev webapp is accessible)
TRIGGER_API_URL=https://trigger.yourdomain.com

# Worker token (get from webapp logs after first deploy)
# Run: docker logs <trigger-container> | grep -A15 "Worker Token"
TRIGGER_WORKER_TOKEN=tr_wgt_xxxxxxxxxxxxx

# Must match webapp's SERVICE_PASSWORD_MANAGEDWORKER
MANAGED_WORKER_SECRET=your-managed-worker-secret

# ============================================
# REQUIRED: Registry Settings
# ============================================

# Registry URL (where your Docker registry is accessible)
DOCKER_REGISTRY_URL=https://registry.yourdomain.com

# Registry credentials (get from webapp's Coolify environment variables)
REGISTRY_USERNAME=trigger
# This is the auto-generated password from webapp (SERVICE_PASSWORD_REGISTRY in Coolify)
REGISTRY_PASSWORD=your-webapp-service-password-registry

# ============================================
# REQUIRED: Docker Network
# ============================================

# Network name on THIS worker server (from Coolify dashboard for this server)
# This should be the network created by Coolify for this worker service
DOCKER_RUNNER_NETWORKS=worker-generated-network-name

# ============================================
# OPTIONAL: Performance Tuning
# ============================================

# Number of parallel job dequeue threads (increase for more throughput)
DEQUEUE_CONSUMER_COUNT=10

# Jobs processed per dequeue cycle
DEQUEUE_RUN_COUNT=50

# Poll interval in milliseconds (lower = more responsive, higher CPU)
DEQUEUE_INTERVAL_MS=500

# Enforce machine preset resource limits (recommended: 1)
ENFORCE_MACHINE_PRESETS=1

# Enforce Docker resource limits for machine presets
DOCKER_ENFORCE_MACHINE_PRESETS=false

# Debug mode (set to 1 for troubleshooting)
DEBUG=0

# ============================================
# SCALING GUIDE
# ============================================
# For a server with 64 vCPU / 128GB RAM running small-1x tasks:
# - Each small-1x task uses 0.5 vCPU, 0.5GB RAM
# - Theoretical max: ~128 concurrent tasks
# - Recommended (with 20% headroom): ~100 concurrent tasks
#
# Adjust DEQUEUE_CONSUMER_COUNT and DEQUEUE_RUN_COUNT based on:
# - Higher values = more throughput but higher resource usage
# - Lower values = less resource contention
