# Webapp Environment Variables for Distributed Trigger.dev Setup
# ==============================================================
# This file is for the WEBAPP server (databases + trigger app)
# Workers connect to this webapp using the token generated at startup

# Required after first deployment (get network name from Coolify dashboard)
DOCKER_RUNNER_NETWORKS=your-generated-network-name

# Registry username (password is auto-generated by Coolify as SERVICE_PASSWORD_REGISTRY)
REGISTRY_USERNAME=trigger

# ============================================
# IMPORTANT: Save these values for workers
# ============================================
# After deployment, you need to provide these to your worker servers:
# 1. SERVICE_URL_TRIGGER (webapp URL)
# 2. SERVICE_URL_REGISTRY (registry URL)
# 3. TRIGGER_WORKER_TOKEN (from logs: docker logs <trigger-container> | grep "Worker Token")
# 4. SERVICE_PASSWORD_MANAGEDWORKER (same secret as webapp)
# 5. SERVICE_PASSWORD_REGISTRY (auto-generated registry password)
# 6. REGISTRY_USERNAME (default: trigger)

# ============================================
# BACKUP CONFIGURATION (Optional)
# Set BACKUP_ENABLED=true to enable automatic backups
# ============================================

# Enable backups (set to "true" to enable)
BACKUP_ENABLED=false

# S3-Compatible Storage (Required when backups are enabled)
BACKUP_S3_ENDPOINT=https://s3.amazonaws.com
BACKUP_S3_BUCKET=my-trigger-backups
BACKUP_S3_ACCESS_KEY_ID=your-access-key
BACKUP_S3_SECRET_ACCESS_KEY=your-secret-key
BACKUP_S3_REGION=us-east-1

# PostgreSQL Backup Settings (Optional - defaults shown)
# BACKUP_POSTGRES_SCHEDULE=0 2 * * *
# BACKUP_POSTGRES_KEEP_DAYS=60

# Redis Backup Settings (Optional - defaults shown)
# BACKUP_REDIS_SCHEDULE=0 3 * * *
# BACKUP_REDIS_KEEP_DAYS=60

# ============================================================
# POSTGRESQL TUNING (Hetzner Cloud NVMe Servers)
# Uncomment ONE section based on your server size
# ============================================================

# --- TIER 1: 4 vCPU, 16GB RAM (NVMe) ---
PG_SHARED_BUFFERS=4GB
PG_EFFECTIVE_CACHE_SIZE=12GB
PG_WORK_MEM=64MB
PG_MAINTENANCE_WORK_MEM=1GB
PG_MAX_CONNECTIONS=1000

# --- TIER 2: 8 vCPU, 32GB RAM (NVMe) ---
# PG_SHARED_BUFFERS=8GB
# PG_EFFECTIVE_CACHE_SIZE=24GB
# PG_WORK_MEM=128MB
# PG_MAINTENANCE_WORK_MEM=2GB
# PG_MAX_CONNECTIONS=1500

# --- TIER 3: 16 vCPU, 64GB RAM (NVMe) ---
# PG_SHARED_BUFFERS=16GB
# PG_EFFECTIVE_CACHE_SIZE=48GB
# PG_WORK_MEM=256MB
# PG_MAINTENANCE_WORK_MEM=4GB
# PG_MAX_CONNECTIONS=2000

# --- TIER 4: 32 vCPU, 128GB RAM (NVMe) ---
# PG_SHARED_BUFFERS=32GB
# PG_EFFECTIVE_CACHE_SIZE=96GB
# PG_WORK_MEM=512MB
# PG_MAINTENANCE_WORK_MEM=8GB
# PG_MAX_CONNECTIONS=3000

# ============================================================
# REDIS TUNING (Hetzner Cloud NVMe Servers)
# Uncomment ONE section based on your server size
# ============================================================

# --- TIER 1: 4 vCPU, 16GB RAM (NVMe) ---
REDIS_MAXMEMORY=6gb
REDIS_IO_THREADS=4

# --- TIER 2: 8 vCPU, 32GB RAM (NVMe) ---
# REDIS_MAXMEMORY=12gb
# REDIS_IO_THREADS=6

# --- TIER 3: 16 vCPU, 64GB RAM (NVMe) ---
# REDIS_MAXMEMORY=24gb
# REDIS_IO_THREADS=8

# --- TIER 4: 32 vCPU, 128GB RAM (NVMe) ---
# REDIS_MAXMEMORY=48gb
# REDIS_IO_THREADS=12

# ============================================================
# CLICKHOUSE TUNING (Hetzner Cloud NVMe Servers)
# Uncomment ONE section based on your server size
# ============================================================

# --- TIER 1: 4 vCPU, 16GB RAM (NVMe) ---
CH_MAX_THREADS=4
CH_MARK_CACHE_SIZE=1073741824

# --- TIER 2: 8 vCPU, 32GB RAM (NVMe) ---
# CH_MAX_THREADS=8
# CH_MARK_CACHE_SIZE=2147483648

# --- TIER 3: 16 vCPU, 64GB RAM (NVMe) ---
# CH_MAX_THREADS=14
# CH_MARK_CACHE_SIZE=4294967296

# --- TIER 4: 32 vCPU, 128GB RAM (NVMe) ---
# CH_MAX_THREADS=28
# CH_MARK_CACHE_SIZE=8589934592

# ============================================================
# SERVICE RESOURCE LIMITS (Hetzner Cloud NVMe Servers)
# Uncomment ONE section based on your server size
# ============================================================

# --- TIER 1: 4 vCPU, 16GB RAM (NVMe) ---
TRIGGER_CPUS=2
TRIGGER_MEMORY=4G
POSTGRES_CPUS=2
POSTGRES_MEMORY=6G
REDIS_CPUS=1
REDIS_MEMORY=7G
CLICKHOUSE_CPUS=1
CLICKHOUSE_MEMORY=2G
ELECTRIC_CPUS=1
ELECTRIC_MEMORY=1G
MINIO_CPUS=1
MINIO_MEMORY=1G
REGISTRY_CPUS=1
REGISTRY_MEMORY=512M

# --- TIER 2: 8 vCPU, 32GB RAM (NVMe) ---
# TRIGGER_CPUS=4
# TRIGGER_MEMORY=8G
# POSTGRES_CPUS=4
# POSTGRES_MEMORY=12G
# REDIS_CPUS=2
# REDIS_MEMORY=14G
# CLICKHOUSE_CPUS=2
# CLICKHOUSE_MEMORY=4G
# ELECTRIC_CPUS=1
# ELECTRIC_MEMORY=2G
# MINIO_CPUS=1
# MINIO_MEMORY=2G
# REGISTRY_CPUS=1
# REGISTRY_MEMORY=1G

# --- TIER 3: 16 vCPU, 64GB RAM (NVMe) ---
# TRIGGER_CPUS=8
# TRIGGER_MEMORY=16G
# POSTGRES_CPUS=6
# POSTGRES_MEMORY=24G
# REDIS_CPUS=4
# REDIS_MEMORY=28G
# CLICKHOUSE_CPUS=4
# CLICKHOUSE_MEMORY=8G
# ELECTRIC_CPUS=2
# ELECTRIC_MEMORY=4G
# MINIO_CPUS=2
# MINIO_MEMORY=4G
# REGISTRY_CPUS=2
# REGISTRY_MEMORY=2G

# --- TIER 4: 32 vCPU, 128GB RAM (NVMe) ---
# TRIGGER_CPUS=16
# TRIGGER_MEMORY=32G
# POSTGRES_CPUS=12
# POSTGRES_MEMORY=48G
# REDIS_CPUS=8
# REDIS_MEMORY=56G
# CLICKHOUSE_CPUS=8
# CLICKHOUSE_MEMORY=16G
# ELECTRIC_CPUS=4
# ELECTRIC_MEMORY=8G
# MINIO_CPUS=4
# MINIO_MEMORY=8G
# REGISTRY_CPUS=2
# REGISTRY_MEMORY=4G
